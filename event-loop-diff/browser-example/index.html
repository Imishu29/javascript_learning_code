<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Browser Event Loop Demo</title>
    <style>
      body { font-family: system-ui, sans-serif; padding: 2rem; }
      code { background: #f5f5f5; padding: 0.2rem 0.4rem; border-radius: 4px; }
    </style>
  </head>
  <body>
    <h1>Browser Event Loop Demo</h1>
    <p>Open the console to see the ordering of tasks and microtasks.</p>

    <script>
      console.log("START");

      // Microtasks (Promises) run before the next macrotask (setTimeout)
      Promise.resolve().then(() => {
        console.log("Promise.then 1 (microtask)");
      });

      queueMicrotask(() => {
        console.log("queueMicrotask (microtask)");
      });

      setTimeout(() => {
        console.log("setTimeout 0ms (macrotask)");
      }, 0);

      // Simulate a DOM operation and a frame render opportunity
      const el = document.createElement("div");
      el.textContent = "Hello, DOM!";
      document.body.appendChild(el);

      // More microtasks
      Promise.resolve().then(() => {
        console.log("Promise.then 2 (microtask)");
      });

      console.log("END");

      /*
      Expected ordering (simplified):

      START
      END
      Promise.then 1 (microtask)
      queueMicrotask (microtask)
      Promise.then 2 (microtask)
      setTimeout 0ms (macrotask)
      
      After tasks/microtasks, the browser may perform rendering.
      */
    </script>
  </body>
</html>
